\environment env_cards

\starttext

\tolerance 9999
\emergencystretch 3em
\vfuzz\hfuzz

<% cards.forEach(function(card) { -%>

% Back

\constellationtitle{<%- card.back.name -%>}
\constellationstack{<%- card.stack.name -%>}

<% if (card.back.flavor) { -%>
\constellationquote{<%- card.back.flavor -%>}
<% }; -%>

<%- description(card.back.description) -%>

<% if (card.back.prompts) { -%>
\startitemize[nowhite]
<% card.back.prompts.forEach(function(prompt) { -%>
\item <%- prompt %>
<% }); -%>
\stopitemize
<% }; -%>

\vfill

\constellationrule{BACK: <%- card.back.rule -%>}

\page

% Front

\constellationtitle{<%- card.front.name -%>}
\constellationstack{<%- card.front.name -%>}

<% if (card.front.flavor) { -%>
\constellationquote{<%- card.front.flavor -%>}
<% }; -%>

<%- description(card.front.description) -%>

<% if (card.front.prompts) { -%>
\startitemize[nowhite]
<% card.front.prompts.forEach(function(prompt) { -%>
\item <%- prompt %>
<% }); -%>
\stopitemize
<% }; -%>

\vfill

\constellationrule{FRONT: <%- card.front.rule -%>}

\page

<% }); -%>

\stoptext
